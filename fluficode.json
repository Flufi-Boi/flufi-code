[".folder","fluficode",[[".folder","packages",[],"c #7a1212 square 0 2 10 4 c #f24b4b square -8 6 2 2 line -5 7 3 0 square 0 -1 10 5 w 8 square 0 -0.5 5 0"],[".osl","script","import \"window_tools\" as \"wt\"\nimport as \"glass\" from \"packages\"\n\nfile \"use_type\" \"osl\"\n\n// fpp boilerplate\n__import @= import;import @= i -> (i.endsWith(\".osl\") ? __import(i) open(i))\nbuild ??= { built: false, package: import(\"./opal.json\").JsonParse() }\n\nobject area @= import(\"./src/area.osl\")\nobject editor @= import(\"./src/editor.osl\")\nobject layout @= import(\"./src/layout.osl\")\nobject icons @= import(\"./src/icons.osl\")\nobject topbar @= import(\"./src/topbar.osl\")\nobject state @= import(\"./src/state.osl\")\nobject files @= import(\"./src/files.osl\")\nobject ohf @= import(\"./src/ohf.osl\")\nobject utils @= import(\"./src/utils.osl\")\nobject menus @= import(\"./src/menus.osl\")\nobject save @= import(\"./src/save.osl\")\nobject settings @= import(\"./src/settings.osl\")\nobject picker @= import(\"./src/picker.osl\")\nobject popup @= import(\"./src/popup.osl\")\nlog import(\"./src/terminal.osl\")\nobject terminal @= import(\"./src/terminal.osl\").terminal\nobject compiler @= import(\"./src/compiler.osl\")\n\nobject rawCompilers @= {\n  fpp: import(\"./src/compilers/fpp.osl\")\n}\n\nvoid compiler.addOpalLikeCompiler(\"fpp\", rawCompilers.fpp)\n\nobject widgets @= {\n  left: [\n    import(\"./widgets/folder.osl\"),\n  ],\n  right: [\n    import(\"./widgets/run.osl\"),\n    //import(\"./widgets/test.osl\"),\n    import(\"./widgets/build.osl\")\n  ]\n}\n\nboolean isPopup = passed_data.popup != null\nobject popupData @= passed_data.popup ?? {}\n\nvoid save.init()\nvoid settings.load()\n\n//void state.loadFolder(\"08b90df05d7840ba31c0e71340b2043b\")\n\nif !window.permissions.contains(\"file admin\") (\n  permission \"request\" \"file admin\"\n)\n\nmainloop:\n  wt:load_theme\n  \n  void picker.update()\n  \n  if isPopup (\n    void popup.update()\n  ) else (\n    if file_dropped != 0 (\n      local f @= open(file_dropped, [1,4,14])\n      if f[1] == \".shortcut\" (\n        local f @= open(f[2], [1,4,14])\n        file_dropped = f[3]\n      )\n      if files.hovered (\n        if f[1] == \".folder\" (\n          void state.loadFolder(f[3])\n        ) else (\n          say \"cannot drag non folder into files\"\n        )\n      )\n      file_dropped = 0\n    )\n    void layout.update()\n    void topbar.update()\n  )\nvoid window.show()",""],[".json","opal","{\"name\": \"editor\", \"version\": \"1.0.0\", \"description\": \"custom editor because i got bored of studio\", \"main\": \"script.osl\", \"dependencies\": {}, \"tags\": [], \"include\": []}",""],[".folder","build",[[".osl","script","build @= { built: true, package: {\"name\":\"editor\",\"version\":\"1.0.0\",\"description\":\"custom editor because i got bored of studio\",\"main\":\"script.osl\",\"dependencies\":{},\"tags\":[],\"include\":[]} }\nopal_imports = {}\ndef import(path) (\n  switch path (\n\ncase \"./widgets/build.osl\"\n  class __imports__2895d3e5b01af9c6f275c35707fd35c0 (\n    number width = 20\n    boolean background = true\n    \n    def earlyUpdate() (\n      local f @= utils.getMain()\n      \n      local comp = compiler.getOslCompiler()\n      self.comp @= comp\n      self.enabled = f != null and comp != null\n    )\n    \n    def update() (\n      goto frame.left + 15 0\n      icon icons.build .6\n      \n      if self.hovered (\n        cursor \"pointer\"\n        if self.clicked (\n          void self.comp.build(utils.folderUuidToPath(state.folder))\n        )\n      )\n    )\n  )\n  return __imports__2895d3e5b01af9c6f275c35707fd35c0\ncase \"./widgets/run.osl\"\n  class __imports__7b17b4f0ec5dec079dbf75a42dd885a6 (\n    number width = 20\n    boolean background = true\n        \n    def earlyUpdate() (\n      local f @= utils.getMain()\n      \n      self.enabled = f != null\n    )\n    \n    def update() (\n      goto 0 0\n      icon icons.play .6\n      \n      if self.hovered (\n        cursor \"pointer\"\n        if self.clicked (\n          local f @= utils.getMain()\n          if f != null (\n            file \"open\" f\n            file \"start\"\n            file \"close\"\n          )\n        )\n      )\n    )\n  )\n  return __imports__7b17b4f0ec5dec079dbf75a42dd885a6\ncase \"./widgets/folder.osl\"\n  class __imports__6ea7205d63c0854cbd1418798a22ae00 (\n    boolean enabled = false\n    boolean background = true\n    \n    def earlyUpdate() (\n      local folder @= open(state.folder)\n      self.enabled = folder != null\n    )\n    \n    def update() (\n      local folder = open(state.folder, [2, 3])\n      self.width = folder[1].len * 10 + 10\n      goto 0 0\n      centext folder[1] 10 : c#txtc\n      if mouse_touching (\n        cursor \"pointer\"\n        if onclick (\n          local p @= Promise.new(() -> (\n            defer\n            while mouse_down (\n              defer\n            )\n            open_rightclick menus.topbar.name() self.folder[2] ++ \"/\" ++ self.folder[1]\n          ))\n          p.worker.folder @= folder\n        )\n      )\n    )\n  )\n  return __imports__6ea7205d63c0854cbd1418798a22ae00\ncase \"./icon.icn\"\n  return \"  c #691f7d c #bf58db w 10 square 0 0 5 5 c #111 w 8 square 0 0 5 5 dot 0 0 c #bf58db w 1.5 line -6 0 -6 4 cutcircle -4 4 2 -4.5 45 line -4 6 -3 6 line -6 2.5 -4 2.5 cutcircle 2 2 2 -13.5 45 line 0 2 0 4 cutcircle 2 4 2 -4.5 45 line 2 0 2.5 0 line 2 6 2.5 6 w 2 line -5.75 -5 0 -5\"\n\ncase \"./src/compilers/fpp.osl\"\n  class __imports__fb470ba1c39d1455e38658fdff807d2e (\n    // welcome to fpp :P\n    // this is meant as an alternative to opal, with a few extra features i wanted :3\n    // (a lot of this will be code from opal)\n    // fpp is also fully compatible with opal (it uses opal.json)\n    \n    // package src\n    local repo = \"https://opal.mistium.com\"\n    \n    local log @= def(d) -> (\n      if d.contains(\"\\n\") (\n        d = d.split(\"\\n\")\n        for i d.len (\n          terminal.writeLine(d[i])\n        )\n        return\n      )\n      terminal.writeLine(d)\n    )\n    \n    local pwd = terminal.pwd.split(\"/\")\n    pwd[1] = \"\"\n    pwd @= pwd.join(\"/\")\n    \n    local c @= {\n      err: \"#FF2929\",\n      ok: \"#31ba1c\",\n      fpp: \"#8457d9\"\n    }\n    \n    local fpp @= {\n      about: {\n        version: \"1.3.1\"\n      },\n      getPackages: def() -> (\n        local val @= self.open(\"packages.folder\")\n        local resp @= self.resp\n        if val.exists (\n          local json = val.data.JsonParse()\n          if typeof(json) != \"array\" (\n            return resp(\"log\", [\n              c.err, \"packages/ seems to be corrupted, use \",\n              c.fpp, \"fpp init\",\n              c.err, \" to reset your project\"\n            ])\n          )\n          if json.len == 0 (\n            return resp(\"log\", \"No installed opal packages\")\n          )\n          return resp(\"arr\", json.map(v -> open(v, [\"name\"])[1]))\n        ) else (\n          return resp(\"log\", [\n            c.err, \"No packages/ found, use \",\n            c.opl, \"fpp init\",\n            c.err, \" to setup your project\"\n          ])\n        )\n      ),\n      open: def(path) -> (\n        local path = parseFilePath(pwd ++ \"/\" ++ path)\n        file \"exists\" path\n        local data = exists ? open(path) null\n        return { exists, data }\n      ),\n      fetchPackage: def(name) -> (\n        local json = self.fetchFile(name, \"/package.json\")\n        local exists = true\n        if typeof(json) != \"object\" (\n          json = {}\n          exists = false\n        )\n        return { exists, json }\n      ),\n      fetchFile: def(name, file) -> (\n        return (self.repo ++ \"/packages/\" ++ name ++ file).httpGet().JsonParse()\n      ),\n      install: def(name, bypass) -> (\n        local opal_json = self.open(\"opal.json\").data.JsonParse()\n        local v = \"latest\"\n        name = name.split(\":\")\n        if name.len > 1 (\n          v = name[2].replace(\"_\", \".\")\n        )\n        \n        local data = self.fetchPackage(name[1])\n        if !data.exists (\n          log([opal.c.err, \"No package found with that name\"])\n          break\n        )\n        data @= data.json\n        \n        local cur = null\n        local vers @= data.versions\n        if v == \"latest\" (\n          cur @= vers[-1]\n        ) else (\n          for i vers.len (\n            if vers[i].version == v (\n              cur @= vers[i]\n              break\n            )\n          )\n        )\n        if cur == null (\n          log([c.err, \"Unable to find specified version of package\"])\n          return\n        )\n        \n        local install = true\n        if !bypass (\n          log(\"Install \" ++ cur.name ++ \"(\" ++ cur.version ++ \") - size: \" ++ cur.size ++ \"?\")\n          if terminal.input(\"y/n\") != \"y\" (\n            install = false\n          )\n        )\n        if install (\n          if cur.install != null (\n            log(\"Found install script: \" ++ cur.install)\n            // run the package's install script\n            local fn = function(\"opal\", self.fetchFile(name[1], \"/\" ++ cur.version ++ \"/\" ++ cur.install))\n            void fn(fpp)\n            log(\"Finished running install script\")\n          )\n          // write the script its to the /packages directory\n          file \"goto_dir\" self.pwd ++ \"/packages\"\n          log(\"Fetching package script\")\n          local contents = self.fetchFile(name[1], \"/\" ++ cur.version ++ \"/\" ++ cur.main)\n          file \"set_file\" cur.name ++ \".osl\" contents\n          log(\"Written package to drive\")\n          \n          // write to the opal.json\n          file \"goto_dir\" self.pwd\n          log(\"Writing dependencies to opal.json\")\n          opal_json.dependencies ??= {}\n          opal_json.dependencies[cur.name[1]] = cur.version\n          file \"set_file\" \"opal.json\" opal_json.JsonFormat()\n          log(\"Installed\")\n        ) else (\n          log(\"Aborted\")\n        )\n      ),\n      build: def() -> (\n        local cfg @= self.open(\"opal.json\").data.JsonParse()\n        \n        local file @= self.open(cfg.main ?? \"script.osl\")\n        if !file.exists (\n          log([c.err, \"script.osl not found, use \", c.fpp, \"fpp init\", c.err, \" to create a new project\"])\n          return\n        )\n        \n        local ast @= file.data.oslAST()\n        local queue = []\n        for i ast.len (\n          local line = ast[i][1].line\n          for j ast[i].len (\n            ast[i][j].line = line\n            void queue.append(ast[i][j])\n          )\n        )\n        log(\"Parsing script.osl\")\n        log(\"Collecting imports\")\n        \n        local imports @= {}\n        \n        if cfg.include != null (\n          for includeI cfg.include.len (\n            void queue.append({\n              type: \"fnc\",\n              data: \"import\",\n              parameters: [\n                {\n                  type: \"str\",\n                  data: cfg.include[includeI]\n                }\n              ]\n            })\n          )\n        )\n        \n        while queue.len > 0 (\n          local item @= queue.shift()\n          if item.left != null (\n            void queue.append(item.left)\n          )\n          if [\"blk\", \"obj\"].contains(item[\"type\"]) (\n            local data @= item.data\n            for i data.len (\n              for j data[i].len (\n                void queue.append(data[i][j])\n              )\n            )\n          )\n          if item.type == \"arr\" (\n            for i item.data.len (\n              void queue.append(item.data[i])\n            )\n          )\n          if item.right != null (\n            void queue.append(item.right)\n          )\n          if item[\"type\"] == \"fnc\" and item.data == \"function\" (\n            void queue.append(item.parameters[2])\n          )\n          if item[\"type\"] == \"fnc\" and item.data == \"import\" (\n            local params @= item.parameters\n            local invalid_msg = \"Invalid import statement on line \"\n            if params.len != 1 (\n              log([c.err, invalid_msg ++ item.line ++ \", expected 1 parameter, got \" ++ params.len])\n              return\n            )\n            if params[1][\"type\"] != \"str\" (\n              log([c.err, invalid_msg ++ item.line ++ \", expected string parameter, got \" ++ params[1][\"type\"]])\n              return\n            )\n            local path = params[1].data\n            item.type = \"mtd\"\n            item.data = mtd.data\n            item.data[2].parameters[1].data = path\n            log(\"Collected \" ++ path)\n            local parsed = path\n            if path.startsWith(\"./\") (\n              parsed @= parsed.replaceFirst(\".\", self.pwd)\n            )\n            if !path.startsWith(\"origin/\") (\n              local parsed = parseFilePath(parsed)\n            )\n            if imports[path] != null (\n              continue\n            )\n            file \"exists\" parsed\n            if !exists (\n              log([c.err, \"Import file not found: \", parsed])\n              return\n            )\n            local data = open(parsed)\n            if data == null (\n              log([c.err, \"Failed to open import file: \", parsed])\n              return\n            )\n            if path.endsWith(\".osl\") (\n              try (\n                local ast_cur @= data.oslAST()\n                for i ast_cur.len (\n                  local line = ast_cur[i][1].line\n                  for j ast_cur[i].len (\n                    ast_cur[i][j].line = line\n                    void queue.append(ast_cur[i][j])\n                  )\n                )\n              ) catch e (\n                log([c.err, \"Failed to parse import file: \", parsed, \"\\nError: \", e])\n                return\n              )\n            )\n            imports[path] @= data\n          )\n          void item.delete(\"source\")\n        )\n        \n        local prepend = [\"build @= { built: true, package:\" + cfg.JsonStringify() + \"}\"]\n        void prepend.append(\"opal_imports = {}\\ndef import(path) (\\n  switch path (\\n\")\n        local import_keys @= imports.getKeys().reverse()\n        local indent = def(str) -> (\n          return str.replace(\"/^/gm\", \"  \")\n        )\n        for i import_keys.len (\n          local key = import_keys[i]\n          local data = indent(imports[key].strip())\n          local hash = \"__imports__\" ++ key.hashMD5()\n          log(\"Compiled \" ++ key ++ \" \" ++ i ++ \"/\" ++ import_keys.len)\n          void prepend.append(\"case \\\"\" ++ key ++ \"\\\"\")\n          if key.endsWith(\".osl\") (\n            void prepend.append(\"  class \" ++ hash ++ \" (\\n\" ++ indent(data ++ \"\\n)\"))\n            void prepend.append(\"  return \" ++ hash)\n          ) else (\n            void prepend.append(\"  return\" + data.JsonStringify() ++ \"\\n\")\n          )\n        )\n    \n        local out = prepend.join(\"\\n\") ++ \")\\n)\\n\" ++ file.data.replaceFirst(\"__import @= import;import @= i -> (i.endsWith(\\\".osl\\\") ? __import(i) open(i))\",\"\").replaceFirst(\"build ??= { built: false, package: import(\\\"./opal.json\\\").JsonParse() }\",\"\")\n    \n        file \"goto_dir\" self.pwd\n        if !self.open(\"build.folder\").exists (\n          log(\"Creating /build directory\")\n          file \"set_file\" \"build.folder\"\n        )\n        file \"open\" \"build.folder\"\n        file \"set\" 11 \"c #703d00 square 0 2 10 4 c #FF9800 square -8 6 2 2 line -5 7 3 0 square 0 -1 10 5 w 8 square 0 -0.5 5 0\"\n        file \"close\"\n        \n        file \"goto_dir\" self.pwd ++ \"/build\"\n        log(\"Writing built file\")\n        file \"set_file\" \"script.osl\" out\n        log(\"Written to /build/script.osl\")\n        local icn = self.open(\"icon.icn\").data\n        if icn != null (\n          file \"open\" \"script.osl\"\n          file \"set\" 11 icn\n          file \"close\"\n        )\n        if cfg.icon != null (\n          file \"open\" \"script.osl\"\n          file \"set\" 11 cfg.icon\n          file \"close\"\n        )\n      ),\n      format: {\n        arr: v -> v.join(\", \").wrapText(40)\n      }\n    }\n    \n    fpp.c @= c\n    fpp.log @= log\n    fpp.pwd @= pwd\n    fpp.repo @= repo\n    fpp.resp @= (t, d) -> {t, d}\n    \n    object compilerObj @= fpp\n  )\n  return __imports__fb470ba1c39d1455e38658fdff807d2e\ncase \"./src/compiler.osl\"\n  class __imports__6409edc6fbbe89eafe887edcac9839db (\n    object compilers @= {}\n    \n    def addCompiler(string name, object compiler, object extra) (\n      compiler.extra @= extra\n      self.compilers[name] @= compiler\n    )\n    \n    def addOpalLikeCompiler(string name, object mod) (\n      // override open\n      mod.compilerObj.open @= def(path) -> (\n        local path = terminal.pwd ++ \"/\" ++ path\n        if !path.startsWith(\"origin/\") (\n          path = parseFilePath(path)\n        )\n        file \"exists\" path\n        local data = exists ? open(path) null\n        return { exists, data }\n      )\n      \n      void self.addCompiler(name, {\n        build: def(string pwd) -> (\n          local usrPath = \"origin/(c) users/\" ++ username\n          if pwd.toLower().startsWith(usrPath.toLower()) (\n            pwd = \"~\" ++ pwd.trim(usrPath.len + 1, -1)\n          )\n          terminal.pwd = pwd\n          self.extra.pwd = pwd\n          void self.extra.build()\n        )\n      }, mod.compilerObj)\n    )\n    \n    // langs\n    def getOslCompiler() (\n      local out = null\n      \n      out ??= self.compilers.fpp\n      \n      return out\n    )\n  )\n  return __imports__6409edc6fbbe89eafe887edcac9839db\ncase \"./src/popup.osl\"\n  class __imports__61f43d578401814c74122435d0e6eb11 (\n    object popups = {\n      testPopup: {\n        update: () -> (\n          centext \"hi\" 10\n        )\n      }  \n    }\n    \n    def openPopup(object popup) (\n      window.create(window.file.uuid, {\n        passed_data: {\n          popup\n        },\n      })\n    )\n    \n    def update() (\n      void self.updateTopbar()\n    )\n    \n    def updateTopbar() (\n      //void topbar.resetDragbox()\n      \n      void topbar.updateWinButtons(topbar.defaultButtons, true)\n    )\n  )\n  return __imports__61f43d578401814c74122435d0e6eb11\ncase \"./src/picker.osl\"\n  class __imports__e7e0c81ced745ae6e1b615bbfa83b58f (\n    object pickers = {}\n    \n    def update() (\n      if new_transmit (\n        local keys @= pickers.getKeys()\n        for i keys.len (\n          if transmit_source == keys[i] (\n            local p @= pickers[keys[i]]\n            void p[1](open(transmit_data), transmit_data, p[2])\n            void pickers.delete(keys[i])\n          )\n        )\n        new_transmit = false\n      )\n    )\n    \n    def openPicker(array types, function callback, arg) (\n      file \"pick\" types\n      picker.pickers[data] @= [callback, arg]\n    )\n  )\n  return __imports__e7e0c81ced745ae6e1b615bbfa83b58f\ncase \"./src/settings.osl\"\n  class __imports__eed2d8cf3c2aa3bfe5551e9b06c28d44 (\n    object entries = {\n      test: {\n        bleh: {\n          type: \"boolean\",\n          desc: \"fr\",\n          default: false\n        }\n      }\n    }\n    \n    object _data = {}\n    \n    def load() (\n      if !save.exists(\"settings.json\") (\n        void self.write()\n      )\n      self._data @= self.deserialize(save.get(\"settings.json\"))\n      void self.applySettings()\n      void self.write()\n    )\n    \n    def write() (\n      void save.set(\"settings.json\", self.serialize())\n    )\n    \n    def get(string category, string entry) (\n      return self._data[category][entry]\n    )\n    def set(string category, string entry, value) (\n      local entryData @= self.entries[category][entry]\n      if entryData == null (\n        throw \"setting\" + category ++ \"/\" ++ entry + \"doesnt exist\"\n      )\n      \n      if entryData.type != typeof(value) (\n        throw \"expected\" + entry.type + \"for\" + category ++ \"/\" ++ entry + \"but got\" + typeof(value)\n      )\n      self._data[category][entry] @= value\n      void self.write()\n      void self.applySettings()\n    )\n    \n    def applySettings() (\n      local categoryData @= self.entries.getEntries()\n      for categoryI categoryData.len (\n        local category @= categoryData[categoryI]\n        local entryData @= category[2].getEntries()\n        for entryI entryData.len (\n          local entry @= entryData[entryI]\n          local value = self._data[category[1]][entry[1]] ?? entry[2].default\n          if entry[2].applySetting != null (\n            void entry[2].applySetting(value)\n          )\n        )\n      )\n    )\n    \n    def serialize() (\n      local out @= {}\n      local categoryData @= self.entries.getEntries()\n      for categoryI categoryData.len (\n        local category @= categoryData[categoryI]\n        out[category[1]] @= {}\n        local entryData @= category[2].getEntries()\n        for entryI entryData.len (\n          local entry @= entryData[entryI]\n          local value = self._data[category[1]][entry[1]] ?? entry[2].default\n          out[category[1]][entry[1]] @= value\n        )\n      )\n      return out.JsonStringify()\n    )\n    def deserialize(string data) (\n      local raw @= data.JsonParse()\n      \n      local out @= {}\n      local categoryData @= self.entries.getEntries()\n      for categoryI categoryData.len (\n        local category @= categoryData[categoryI]\n        out[category[1]] @= {}\n        local entryData @= category[2].getEntries()\n        for entryI entryData.len (\n          local entry @= entryData[entryI]\n          local value = raw[category[1]][entry[1]] ?? entry[2].default\n          out[category[1]][entry[1]] @= value\n        )\n      )\n      return out\n    )\n  )\n  return __imports__eed2d8cf3c2aa3bfe5551e9b06c28d44\ncase \"./src/save.osl\"\n  class __imports__cc67bf7e28ec083154c7e851dbd8117f (\n    def init() (\n      void self.setName(\"code@flufi\")\n    )\n    \n    def setName(string name) (\n      save name \"set_directory\"\n    )\n    \n    def exists(string fileName) (\n      return fileName.saveExists()\n    )\n    \n    def get(string fileName) (\n      if !self.exists(fileName) (\n        throw fileName ++ \"does not exist\"\n      )\n    \n      return fileName.saveGet().toStr()\n    )\n    \n    def set(string fileName, string data) (\n      save fileName \"set\" data\n    )\n  )\n  return __imports__cc67bf7e28ec083154c7e851dbd8117f\ncase \"./src/menus.osl\"\n  class __imports__25b12eaccc0fc7b33e81f6504e5d7022 (\n    def createMenu() (\n      return []\n    )\n    def addButton(array menu, string text, function func) (\n      local obj @= menus.empty()\n      obj[text.toTitle()] @= func\n      void menu.append(obj)\n    )\n    def addSeperator(array menu) (\n      void menu.append(\"-\")\n    )\n    \n    empty @= () -> (\n      local obj @= {\"bleh\":def()->()}\n      void obj.delete(\"bleh\")\n      return obj\n    )\n    \n    object topbar = {\n      name: () -> (\n        local menu @= menus.createMenu()\n        \n        void menus.addButton(menu, \"copy folder path\", (data) -> (\n          clipboard \"set\" data.replace(\"origin/(c) users/\" ++ username, \"~\")\n        ))\n        \n        return menu\n      ),\n      \n      top_menus: {\n        file: () -> (\n          local menu @= menus.createMenu()\n          \n          void menus.addButton(menu, \"new\", () -> (\n            topbar.menusOpen = false\n            \n            void state.clearFolder()\n          ))\n          \n          void menus.addSeperator(menu)\n          \n          void menus.addButton(menu, \"open file\", (data) -> (\n            topbar.menusOpen = false\n            \n            void picker.openPicker([], def(content, uuid) -> (\n              local editor @= utils.getEditorAndAdd()\n              if editor != null (\n                void editor.openFile(uuid)\n              )\n            ))\n          ))\n          void menus.addButton(menu, \"open folder\", (data) -> (\n            topbar.menusOpen = false\n            \n            void picker.openPicker([\"folder\"], def(content, uuid) -> (\n              void state.loadFolder(uuid)\n            ))\n          ))\n          \n          return menu\n        ),\n        edit: () -> (\n          local menu @= menus.createMenu()\n          \n          return menu\n        )\n      }\n    }\n    \n    object editor = {\n      more: () -> (\n        log menus\n        local menu @= menus.createMenu()\n        \n        void menus.addButton(menu, \"new editor to the left\", () -> (\n          void layout.editors.insert(editor.selectedEditor, editor.Editor())\n        ))\n        void menus.addButton(menu, \"new editor to the right\", () -> (\n          void layout.editors.insert(editor.selectedEditor + 1, editor.Editor())\n        ))\n        \n        if layout.editors.len > 1 (\n          void menus.addSeperator(menu)\n          void menus.addButton(menu, \"remove Editor\", () -> (\n            void layout.editors.delete(editor.selectedEditor)\n          ))\n        )\n        \n        return menu\n      )\n    }\n  )\n  return __imports__25b12eaccc0fc7b33e81f6504e5d7022\ncase \"./src/utils.osl\"\n  class __imports__4500036a1de35802b8dcb4fd720972a2 (\n    def getEditorAndAdd() (\n      if layout.editors.len == 0 (\n        void layout.editors.append(editor.Editor())\n      )\n      return getEditor()\n    )\n    def getEditor() (\n      local editorI = editor.selectedEditor ?? 1\n      local editor @= layout.editors.filter(e -> e.i == editorI)[1]\n      return editor\n    )\n    \n    def getTab() (\n      local e @= getEditor()\n      return e.tabs[e.selectedTab]\n    )\n    \n    def getMain() (\n      void state.loadOpal()\n      \n      local opalMain = state.opal.main\n      if typeof(opalMain) == \"string\" (\n        local folder @= open(state.folder, [2,3])\n        return folder[2] ++ \"/\" ++ folder[1] ++ \"/\" ++ opalMain\n      )\n      \n      return self.getTab().file_uuid\n    )\n    \n    def fileUuidToPath(string uuid) (\n      local fdata @= open(uuid, [1,2,3])\n      \n      return fdata[3] ++ \"/\" ++ fdata[2] ++ fdata[1]\n    )\n    \n    def folderUuidToPath(string uuid) (\n      local fdata @= open(uuid, [2,3])\n      \n      return fdata[2] ++ \"/\" ++ fdata[1]\n    )\n  )\n  return __imports__4500036a1de35802b8dcb4fd720972a2\ncase \"./src/ohf.osl\"\n  class __imports__897e4e2423deb74a5324dd50b0eaea87 (\n    def compileOhf(ohf) (\n      if typeof(ohf) == \"string\" (\n        ohf @= ohf.JsonParse()\n      )\n      if typeof(ohf) != \"object\" (\n        return \"\"\n      )\n      \n      local output @= {\n        tokens: {},\n        overrides: {},\n        parser: {}\n      }\n    \n      try (\n        if ohf.categories != null (\n          each o ohf.categories.getValues() (\n            each r o.tokens (\n              output.tokens[\"tkn:\" ++ r] = o.color\n            )\n          )\n        )\n      \n        if ohf.overrides != null (\n          each o ohf.overrides.getKeys() (\n            output.overrides[o] = ohf.overrides[o]\n          )\n        )\n      \n        output.parser = ohf.parser ?? {}\n        output.highlighter = ohf.highlighter ?? {}\n      ) catch o (\n        error o\n        return \"\"\n      )\n      return output\n    )\n    \n    def getCompiledOhf(string kind) (\n      return compileOhf(getOhf(kind))\n    )\n    \n    def getOhf(string kind) (\n      return open(\"~/application data/Studio/\" ++ kind.trim(2,-1) ++ \".ohf\")\n    )\n  )\n  return __imports__897e4e2423deb74a5324dd50b0eaea87\ncase \"./src/files.osl\"\n  class __imports__6c459cf0012bdb7372e3f2253de450a7 (\n    number width = 200\n    number height = 0\n    object opened = {}\n    \n    number x = 0\n    number y = 0\n    \n    def update(array a) (\n      goto area.centerX(a) area.centerY(a)\n      square area.width(a) area.height(a) : c#prim\n      square area.width(a) - 3 area.height(a) - 3 : c#window_colour\n      \n      c prim\n      frame a[1] a[2] a[3] a[4] self.height \"files\" (\n        local hover = mouse_x >= frame.left and mouse_x <= frame.right\n        hover = hover and mouse_y >= frame.bottom and mouse_y <= frame.top\n        self.hovered = hover\n        if file_dragging and hover (\n          centext \"drop folder here\" 9 : c#txtc\n          return\n        )\n        \n        local folder @= open(state.folder)\n        if typeof(folder) != \"array\" (\n          centext \"no open folder\" 9 : c#prim\n          return\n        )\n        \n        self.x = frame.left\n        self.y = frame.top + frame.scroll\n        local start = self.y\n        drawContents(folder)\n        self.height = start - self.y\n      )\n    )\n    \n    def drawContents(array items) (\n      items @= items.map(i -> [i, open(i, [1])])\n      \n      local folders @= items.filter(i -> i[2][1] == \".folder\")\n      local files @= items.filter(i -> i[2][1] != \".folder\")\n      \n      for i folders.len (\n        drawFile(folders[i][1])\n      )\n      for i files.len (\n        drawFile(files[i][1])\n      )\n      // stops compiler from being weird\n      return\n      square\n    )\n    \n    def drawFile(string uuid) (\n      self.y -= 15\n      \n      local f @= open(uuid, [1,2,3,11])\n      \n      goto 0 self.y\n      square frame.width 20 10 0 1\n      rightclick \"file\" uuid\n      local hover = mouse_touching and !layout.filesResizing and !layout.filesResizingHover\n      local click = onclick and !layout.filesResizing\n      \n      if hover (\n        square frame.width - 15 15 10 : c#prim\n        cursor \"pointer\"\n      )\n      \n      goto self.x self.y\n      \n      if f[1] == \".folder\" (\n        local open = self.opened[uuid] ?? false\n        \n        icon open ? \"down\" \"right\" .45 : chx#15 c#txtc\n        file \"render\" .6 : chx#20\n        text f[2] 9 : c#txtc chx#15\n        \n        self.x += 20\n        self.y -= 15\n        \n        if open (\n          drawContents(open(uuid))\n        )\n        \n        self.x -= 20\n        \n        if click (\n          self.opened[uuid] = !open\n        )\n      ) else (\n        file \"render\" .6 : chx#15\n        text f[2] 9 : c#txtc chx#15\n        text f[1] 8 : c#seco\n        self.y -= 15\n        \n        if click (\n          local editor @= utils.getEditorAndAdd()\n          if editor != null (\n            void editor.openFile(uuid)\n          )\n        )\n      )\n    )\n  )\n  return __imports__6c459cf0012bdb7372e3f2253de450a7\ncase \"./src/state.osl\"\n  class __imports__7576a2b49d81733616f3acd68d545597 (\n    string folder = \"\"\n    object opal = {}\n    \n    def loadFolder(string uuid) (\n      if uuid == \"\" (\n        self.clearFolder()\n        return\n      )\n      \n      local f @= open(uuid, [1,2,3])\n      if f[1] != \".folder\" (\n        say \"given folder is not a folder\"\n        return\n      )\n      \n      self.folder = uuid\n      loadOpal()\n    )\n    \n    def clearFolder() (\n      self.folder = \"\"\n      self.opal @= {}\n    )\n    \n    def loadOpal() (\n      local f @= open(self.folder, [2,3])\n      local opalf @= open(f[2] ++ \"/\" ++ f[1] ++ \"/\" ++ \"opal.json\")\n      if typeof(opalf) == \"string\" (\n        opalf @= opalf.JsonParse()\n      )\n      if typeof(opalf) == \"object\" (\n        self.opal @= opalf\n      )\n    )\n  )\n  return __imports__7576a2b49d81733616f3acd68d545597\ncase \"./src/topbar.osl\"\n  class __imports__ec116b9cd375e5297768166f7fffe095 (\n    boolean debug = false\n    array defaultButtons = [\n      {\n        icon: \"close\",\n        click: window.close\n      },\n      {\n        icon: \"down\",\n        click: window.minimise\n      },\n      {\n        icon: \"maximise\",\n        click: window.fullscreen\n      }\n    ]\n    \n    boolean menusOpen = false\n    \n    def updateWinButtons(array buttons, boolean background) (\n      if background (\n        local w = buttons.len * 25\n        \n        loc -2 2 w / -2 - 7.5 -20\n        square w - 5 18 10 : c#prim\n      )\n      \n      loc -2 2 -20 -20\n      change_x 25\n      local i = 0\n      local len = buttons.len\n      while i < len (\n        i ++\n      //for i buttons.len (\n        local p = performance\n        local button @= buttons[i]\n        local p2 = performance\n        \n        c txtc\n        local p3 = performance\n        icon button.icon 0.6 * (button.icon_size ?? 1) : hover_size#1.1 chx#-25\n        \n        local p4 = performance\n        if mouse_touching (\n          cursor \"pointer\"\n          if onclick (\n            void button.click()\n          )\n        )\n        local p5 = performance\n        if background (\n          log p6 p p - p6\n        )\n        local p6 = performance\n      )\n      change_x -25\n      self.buttonsX = x_position\n    )\n    \n    def updateWidgets(array widgets, string side) (\n      local mul = side == \"right\" ? -1 1\n      local x = side == \"right\" ? buttonsX window.left + 50 + 35\n      local visualI = 0\n      for i widgets.len (\n        local widget @= widgets[i]\n        if widget.earlyUpdate != null (\n          void widget.earlyUpdate()\n        )\n        if widget.enabled ?? true (\n          visualI ++\n          local w = widget.width ?? 20\n          \n          if visualI != 1 (\n            x += (widget.background ? 10 7.5) * mul\n          ) else (\n            x += widget.background ? 0 -10 * mul\n          )\n          x += w / 2 * mul\n          \n          goto x window.top - 20\n          if widget.background and widget.showBackground ?? true (\n            square w - 5 15 15 : c#prim\n          )\n          \n          square w - 5 15 15 0 1\n          widget.hovered = mouse_touching\n          widget.clicked = onclick\n          \n          frame x - (w / 2) - 5 window.top - 5 x + (w / 2) + 5 window.top - 35 (\n            if widget.update != null (\n              c txtc\n              goto 0 0\n              void widget.update()\n            )\n          )\n          \n          x += w / 2 * mul\n          x += (widget.background ? 10 7.5) * mul\n        )\n      )\n      \n      if side == \"left\" (\n        self.dragbox[1][3] = x - window.left - 5\n      )\n      if side == \"right\" (\n        self.dragbox[2][3] = x - window.right - 5\n      )\n    )\n    \n    def updateLeftSection() (\n      goto window.left + 20 window.top - 20\n      \n      if !self.menusOpen (\n        square 25 25 0 0 1 : c#fff\n        icon icons.editor 1.25\n        change_x 35\n      )\n      \n      icon icons.menu 1 : c#txtc\n      if mouse_touching (\n        cursor \"pointer\"\n        if onclick (\n          self.menusOpen = !self.menusOpen\n        )\n      )\n    )\n    \n    def updateMenus() (\n      local x = frame.left\n      \n      local keys @= menus.topbar.top_menus.getKeys()\n      for i keys.len (\n        local name = keys[i].toTitle()\n        local width = name.len * 9 + 20\n        \n        x += width / 2 + 7.5\n        \n        goto x 0\n        square width - 5 15 15 10 : c#prim hover_c#seco\n        local click = onclick\n        centext name 9 : c#txtc\n        \n        x += width / 2 + 10\n        \n        x -= width + 12.5\n        \n        goto x - 5 -25\n        if click (\n          local p @= Promise.new(() -> (\n            defer\n            while mouse_down (\n              defer\n            )\n            open_rightclick self.menu() ?? []\n          ))\n          p.worker.menu @= menus.topbar.top_menus[keys[i]]\n        )\n        \n        x += width + 12.5\n      )\n      \n      self.dragbox[1][3] = x - frame.left + 40\n    )\n    \n    def resetDragbox() (\n      self.dragbox @= [[2,2,0,0],[-2,2,-90,-40]]\n    )\n    \n    def applyDragbox() (\n      window.setDragbox(self.dragbox[1], self.dragbox[2])\n      \n      if self.debug (\n        c #fff\n        loc self.dragbox[1][1] self.dragbox[1][2] self.dragbox[1][3] self.dragbox[1][4]\n        pen \"down\" : w#1\n        loc self.dragbox[2][1] self.dragbox[2][2] self.dragbox[2][3] self.dragbox[2][4]\n        pen \"up\"\n      )\n    )\n    \n    def update() (\n      void self.resetDragbox()\n      \n      void self.updateWinButtons(self.defaultButtons, false)\n      if self.menusOpen (\n        frame window.left + 40 window.top self.buttonsX window.top - 40 (\n          void self.updateMenus()\n        )\n      ) else (\n        void self.updateWidgets(widgets.left, \"left\")\n      )\n      void self.updateWidgets(widgets.right, \"right\")\n      void self.updateLeftSection()\n      \n      void self.applyDragbox()\n    )\n  )\n  return __imports__ec116b9cd375e5297768166f7fffe095\ncase \"./src/icons.osl\"\n  class __imports__390660650b3083b6bb77ea5300ce655c (\n    string build = \"w 2 square 0 -4 2 6 line 6 10 9 10 cont 9 4 cont 6 4 cutcircle 4.5 10 1.5 13.5 45 cutcircle 4.5 4 1.5 4.5 45 line 4.5 8.5 2 8.5 line 4.5 5.5 2 5.5 cont 2 0 cutcircle .5 8.5 1.5 4.5 45 line .5 10 -4 10 curve -4 10 -10 5 -7 10 curve -10 5 -2 4 -2 7 line -2 2 -2 4\"\n    string play = \"w 3.5 line -7 10 7 0 cont -7 -10 cont -7 10\"\n    string menu = \"w 3.85 line -9 8 9 8 line -9 0 9 0 line -9 -8 9 -8\"\n    \n    string editor = import(\"./icon.icn\")\n  )\n  return __imports__390660650b3083b6bb77ea5300ce655c\ncase \"./src/layout.osl\"\n  class __imports__805aadf4abdd4a38d6061c6bb7905445 (\n    array editors @= [\n      editor.Editor(),\n    ]\n    \n    def update() (\n      local screen @= area.boundriesToArea(window.left, window.top, window.right, window.bottom)\n      \n      screen[2] -= 45\n      \n      self.filesResizingHover = false\n      if mouse_y > screen[4] and mouse_y < screen[2] (\n        if abs(screen[1] + files.width - mouse_x) < 5 (\n          cursor \"col-resize\"\n          self.filesResizingHover = true\n          goto mouse_x mouse_y\n          square 100 100 0 0 1\n          if onclick (\n            self.filesResizing = true\n          )\n        )\n      )\n      \n      if !mouse_down (\n        self.filesResizing = false\n      )\n      \n      if self.filesResizing (\n        files.width = mouse_x - screen[1]\n        cursor \"col-resize\"\n      )\n      files.width = min(files.width, area.width(screen) - 200)\n      files.width = max(files.width, 150)\n      \n      void files.update([\n        screen[1],\n        screen[2],\n        screen[1] + files.width,\n        screen[4]\n      ])\n      \n      local editorSpace @= area.copy(screen)\n      editorSpace[1] += files.width\n      updateEditors([\n        screen[1] + files.width,\n        screen[2],\n        screen[3],\n        screen[4]\n      ])\n    )\n    \n    def updateEditors(array editorSpace) (\n      local x = editorSpace[1]\n      local sel = null\n      \n      if self.editors.len == 0 (\n        void self.editors.append(editor.Editor())\n      )\n      \n      if editor.selectedEditor > self.editors.len (\n        editor.selectedEditor = self.editors.len\n      )\n      \n      for i self.editors.len (\n        local curEditor @= self.editors[i]\n        local width = area.width(editorSpace) / self.editors.len\n        \n        curEditor.layoutI = i\n        \n        local a @= [x, editorSpace[2], x + width, editorSpace[4]]\n        \n        void curEditor.update(a)\n        if curEditor.layoutI == editor.selectedEditor (\n          sel @= a\n        )\n        \n        x += width\n      )\n      \n      // kinda looks weird imo, could add a setting tho\n      if sel != null and false (\n        goto sel[1] sel[2]\n        pen \"down\" : c#seco w#2\n        goto sel[3] sel[2]\n        goto sel[3] sel[4]\n        goto sel[1] sel[4]\n        goto sel[1] sel[2]\n        pen \"up\"\n      )\n    )\n  )\n  return __imports__805aadf4abdd4a38d6061c6bb7905445\ncase \"./src/editor.osl\"\n  class __imports__43f488fefabf2ce67b06a4b7a37dc437 (\n    number editorI = 0\n    number selectedEditor = 0\n    number tabI = 0\n    \n    class Editor (\n      number tabsH = 30\n      \n      def init() (\n        self.tabs @= []\n        self.tabScroll = 0\n        self.selectedTab = 0\n        \n        // .btoa().trim(1,-3)\n        self.id = editor.editorI.toStr()\n        self.i = editor.editorI\n        editor.editorI ++\n      )\n      \n      def createTab(string kind, string title, string content) (\n        local dta @= {\n          kind,\n          title,\n          content,\n          id: OuidNew() ++ editor.tabI.toStr()\n        }\n        editor.tabI ++\n        \n        void self.tabs.append(dta)\n        void self.updateTab(dta)\n        self.selectedTab = self.tabs.len\n        return dta\n      )\n      def openFile(string uuid) (\n        local f @= open(uuid, [1,2,3,4])\n        local t @= self.createTab(\"file\", f[2], f[4])\n        t.ohf @= ohf.getCompiledOhf(f[1])\n        t.file_uuid = uuid\n      )\n      def updateTab(object tab) (\n        inputs[self.id ++ tab.id] @= tab.content.split(\"\\n\")\n      )\n      def selectTab(number i) (\n        self.selectedTab = i\n        if self.tabs[self.selectedTab] != null (\n          void self.updateTab(self.tabs[self.selectedTab])\n        )\n      )\n      \n      def update(array a) (\n        goto area.centerX(a) area.centerY(a)\n        square area.width(a) area.height(a) : c#prim\n        if onclick (\n          editor.selectedEditor = self.i\n        )\n        square area.width(a) - 3 area.height(a) - 3 : c#window_colour\n        \n        if self.selectedTab > self.tabs.len (\n          void self.selectTab(self.tabs.len)\n        )\n        if self.selectedTab == 0 (\n          void self.selectTab(1)\n        )\n        \n        void self.updateMore([\n          a[3] - 30,\n          a[2],\n          a[3],\n          a[2] - self.tabsH\n        ])\n        \n        void self.updateTabs([\n          a[1],\n          a[2],\n          a[3] - 30,\n          a[2] - self.tabsH\n        ])\n        \n        void self.updateContent([\n          a[1],\n          a[2] - self.tabsH,\n          a[3],\n          a[4]\n        ])\n      )\n      \n      def updateMore(array a) (\n        goto a[1] a[2]\n        c prim\n        pen \"size\" 1.5\n        pen \"down\"\n        goto a[1] a[4]\n        goto a[3] a[4]\n        pen \"up\"\n        \n        goto area.centerX(a) area.centerY(a)\n        square area.width(a) - 3.5 area.height(a) - 3.5 : c#window_colour hover_c#prim\n        if mouse_touching (\n          cursor \"pointer\"\n          if onclick (\n            local p @= Promise.new(() -> (\n              defer\n              while mouse_down (\n                defer\n              )\n              open_rightclick menus.editor.more()\n            ))\n            editor.selectedEditor = self.layoutI\n          )\n        )\n        icon \"more-vertical\" .65 : c#txtc\n      )\n      \n      def updateTabs(array a) (\n        goto a[1] a[4]\n        c prim\n        pen \"size\" 1.5\n        pen \"down\"\n        goto a[3] a[4]\n        pen \"up\"\n        \n        local width = 0\n        for i self.tabs.len (\n          local tab @= self.tabs[i]\n          tab.width = tab.title.len * 8 + 30 + 30\n          width += tab.width\n        )\n        \n        frame a[1] a[2] a[3] a[4] 0 (\n          goto 0 0\n          square frame.width frame.height 0 0 1\n          if mouse_touching (\n            self.tabScroll += scroll.x.velocity + scroll.y.velocity * -1.5 * scroll.multiplier\n          )\n          self.tabScroll = max(min(self.tabScroll, width - frame.width), 0)\n          \n          local x = frame.left - self.tabScroll\n          local rm = 0\n          for i self.tabs.len (\n            //log tab x\n            local tab @= self.tabs[i]\n            \n            x += tab.width / 2\n            \n            goto x 0\n            square tab.width frame.height 0 0 1\n            if mouse_touching (\n              if onclick (\n                void self.selectTab(i)\n              )\n              goto x frame.bottom + 2\n              square tab.width 1 : c#prim\n            )\n            \n            if self.selectedTab == i (\n              goto x frame.bottom + 2\n              square tab.width 1 : c#seco\n            )\n            \n            goto x 0\n            centext tab.title 8 : c#txtc chx#-10\n            \n            x += tab.width / 2\n            \n            icn = \"close\"\n            \n            goto x - 20 0\n            square 15 15 0 0 1\n            hoverIcn = mouse_touching\n            \n            if tab.kind == \"file\" (\n              local content = inputs[self.id ++ tab.id].join(\"\\n\")\n              local edited = content != open(tab.file_uuid)\n              \n              if edited and !hoverIcn (\n                icn = \"w 17.5 dot 0 0\"\n              )\n            )\n            \n            icon icn .5 : c#txtc\n            if hoverIcn (\n              cursor \"pointer\"\n              if onclick (\n                rm = i\n              )\n            )\n            \n            c prim\n            pen \"size\" 1\n            goto x frame.top\n            pen \"down\"\n            goto x frame.bottom\n            pen \"up\"\n          )\n          \n          if rm != 0 (\n            void self.tabs.delete(rm)\n          )\n          \n          if editor.selectedEditor == self.i (\n            local selTab @= self.tabs[self.selectedTab]\n            if selTab.kind == \"file\" (\n              if \"control\".isKeyDown() and \"s\".onKeyDown() (\n                file \"open\" selTab.file_uuid\n                file \"set\" 4 selTab.content\n                file \"close\"\n              )\n            )\n          )\n        )\n      )\n      \n      def updateContent(array a) (\n        if self.tabs.len == 0 (\n          goto area.centerX(a) area.centerY(a)\n          centext \"no open files :(\" 9 : c#prim\n          return\n        )\n        \n        void self.updateTextbox([\n          a[1],\n          a[2],\n          a[3],\n          a[4]\n        ])\n      )\n      def updateTextbox(array a) (\n        local tab @= self.tabs[self.selectedTab]\n        \n        if tab != null (\n          goto area.centerX(a) area.centerY(a)\n          textbox area.width(a) area.height(a) self.id ++ tab.id 0 {\n            line_numbers: {\n              bg_colour: prim,\n              text_colour: txtc\n            },\n            sel_colour: seco,\n            text_colour: txtc,\n            ohf: tab.ohf\n          }\n          tab.content = inputs[self.id ++ tab.id].join(\"\\n\")\n        )\n      )\n    )\n  )\n  return __imports__43f488fefabf2ce67b06a4b7a37dc437\ncase \"./src/area.osl\"\n  class __imports__2d64d682ed6b046178c913d48fbef49a (\n    def boundriesToArea(number left, number top, number right, number bottom) (\n      return [left, top, right, bottom]\n    )\n    \n    def copy(area) (\n      return [area[1], area[2], area[3], area[4]]\n    )\n    \n    def centerX(area) (\n      return area[1] + area[3] / 2\n    )\n    \n    def centerY(area) (\n      return area[2] + area[4] / 2\n    )\n    \n    def width(area) (\n      return area[3] - area[1]\n    )\n    \n    def height(area) (\n      return area[2] - area[4]\n    )\n  )\n  return __imports__2d64d682ed6b046178c913d48fbef49a\ncase \"./src/terminal.osl\"\n  class __imports__d556ecafbb2343f66266bae2e6fd11c4 (\n    class terminal (\n      lines = []\n      waiting = false\n      show_input = true\n      input_message = null\n      pwd = user_folder\n      \n      def writeLine(data) (\n        if data.contains(\"\\n\") (\n          local parts = data.split(\"\\n\")\n          for i parts.len (\n            void self.lines.append(parts[i])\n          )\n        ) else (\n          void self.lines.append(data)\n        )\n      )\n      \n      def write(data) (\n        self.lines[self.lines.len] ++= data\n      )\n      \n      def clear() (\n        terminal.lines = []\n      )\n      \n      def input(query) (\n        self.show_input = true\n        self.input_message = query\n        while self.show_input (\n          defer\n        )\n        self.input_message = null\n        return last.pop()\n      )\n      \n      def user_start() (\n        if self.input_message != null (\n          return self.input_message ++ \": \"\n        )\n        local pos = self.pwd\n        if pos == user_folder (\n          pos = \"~\"\n        ) else (\n          pos = pos.split(\"/\")[-1]\n        )\n        return username ++ \"@originos \" ++ pos ++ \" % \"\n      )\n    \n      def run(cmd) (\n        return terminal_worker.evalCmd(cmd)\n      )\n    )\n  )\n  return __imports__d556ecafbb2343f66266bae2e6fd11c4)\n)\nimport \"window_tools\" as \"wt\"\nimport as \"glass\" from \"packages\"\n\nfile \"use_type\" \"osl\"\n\n// fpp boilerplate\n\n\n\nobject area @= import(\"./src/area.osl\")\nobject editor @= import(\"./src/editor.osl\")\nobject layout @= import(\"./src/layout.osl\")\nobject icons @= import(\"./src/icons.osl\")\nobject topbar @= import(\"./src/topbar.osl\")\nobject state @= import(\"./src/state.osl\")\nobject files @= import(\"./src/files.osl\")\nobject ohf @= import(\"./src/ohf.osl\")\nobject utils @= import(\"./src/utils.osl\")\nobject menus @= import(\"./src/menus.osl\")\nobject save @= import(\"./src/save.osl\")\nobject settings @= import(\"./src/settings.osl\")\nobject picker @= import(\"./src/picker.osl\")\nobject popup @= import(\"./src/popup.osl\")\nlog import(\"./src/terminal.osl\")\nobject terminal @= import(\"./src/terminal.osl\").terminal\nobject compiler @= import(\"./src/compiler.osl\")\n\nobject rawCompilers @= {\n  fpp: import(\"./src/compilers/fpp.osl\")\n}\n\nvoid compiler.addOpalLikeCompiler(\"fpp\", rawCompilers.fpp)\n\nobject widgets @= {\n  left: [\n    import(\"./widgets/folder.osl\"),\n  ],\n  right: [\n    import(\"./widgets/run.osl\"),\n    //import(\"./widgets/test.osl\"),\n    import(\"./widgets/build.osl\")\n  ]\n}\n\nboolean isPopup = passed_data.popup != null\nobject popupData @= passed_data.popup ?? {}\n\nvoid save.init()\nvoid settings.load()\n\n//void state.loadFolder(\"08b90df05d7840ba31c0e71340b2043b\")\n\nif !window.permissions.contains(\"file admin\") (\n  permission \"request\" \"file admin\"\n)\n\nmainloop:\n  wt:load_theme\n  \n  void picker.update()\n  \n  if isPopup (\n    void popup.update()\n  ) else (\n    if file_dropped != 0 (\n      local f @= open(file_dropped, [1,4,14])\n      if f[1] == \".shortcut\" (\n        local f @= open(f[2], [1,4,14])\n        file_dropped = f[3]\n      )\n      if files.hovered (\n        if f[1] == \".folder\" (\n          void state.loadFolder(f[3])\n        ) else (\n          say \"cannot drag non folder into files\"\n        )\n      )\n      file_dropped = 0\n    )\n    void layout.update()\n    void topbar.update()\n  )\nvoid window.show()","c #691f7d c #bf58db w 10 square 0 0 5 5 c #111 w 8 square 0 0 5 5 dot 0 0 c #bf58db w 1.5 line -6 0 -6 4 cutcircle -4 4 2 -4.5 45 line -4 6 -3 6 line -6 2.5 -4 2.5 cutcircle 2 2 2 -13.5 45 line 0 2 0 4 cutcircle 2 4 2 -4.5 45 line 2 0 2.5 0 line 2 6 2.5 6 w 2 line -5.75 -5 0 -5"]],"c #703d00 square 0 2 10 4 c #FF9800 square -8 6 2 2 line -5 7 3 0 square 0 -1 10 5 w 8 square 0 -0.5 5 0"],[".icn","icon","c #691f7d c #bf58db w 10 square 0 0 5 5 c #111 w 8 square 0 0 5 5 dot 0 0 c #bf58db w 1.5 line -6 0 -6 4 cutcircle -4 4 2 -4.5 45 line -4 6 -3 6 line -6 2.5 -4 2.5 cutcircle 2 2 2 -13.5 45 line 0 2 0 4 cutcircle 2 4 2 -4.5 45 line 2 0 2.5 0 line 2 6 2.5 6 w 2 line -5.75 -5 0 -5",""],[".folder","src",[[".osl","layout","\narray editors @= [\n  editor.Editor(),\n]\n\ndef update() (\n  local screen @= area.boundriesToArea(window.left, window.top, window.right, window.bottom)\n  \n  screen[2] -= 45\n  \n  self.filesResizingHover = false\n  if mouse_y > screen[4] and mouse_y < screen[2] (\n    if abs(screen[1] + files.width - mouse_x) < 5 (\n      cursor \"col-resize\"\n      self.filesResizingHover = true\n      goto mouse_x mouse_y\n      square 100 100 0 0 1\n      if onclick (\n        self.filesResizing = true\n      )\n    )\n  )\n  \n  if !mouse_down (\n    self.filesResizing = false\n  )\n  \n  if self.filesResizing (\n    files.width = mouse_x - screen[1]\n    cursor \"col-resize\"\n  )\n  files.width = min(files.width, area.width(screen) - 200)\n  files.width = max(files.width, 150)\n  \n  void files.update([\n    screen[1],\n    screen[2],\n    screen[1] + files.width,\n    screen[4]\n  ])\n  \n  local editorSpace @= area.copy(screen)\n  editorSpace[1] += files.width\n  updateEditors([\n    screen[1] + files.width,\n    screen[2],\n    screen[3],\n    screen[4]\n  ])\n)\n\ndef updateEditors(array editorSpace) (\n  local x = editorSpace[1]\n  local sel = null\n  \n  if self.editors.len == 0 (\n    void self.editors.append(editor.Editor())\n  )\n  \n  if editor.selectedEditor > self.editors.len (\n    editor.selectedEditor = self.editors.len\n  )\n  \n  for i self.editors.len (\n    local curEditor @= self.editors[i]\n    local width = area.width(editorSpace) / self.editors.len\n    \n    curEditor.layoutI = i\n    \n    local a @= [x, editorSpace[2], x + width, editorSpace[4]]\n    \n    void curEditor.update(a)\n    if curEditor.layoutI == editor.selectedEditor (\n      sel @= a\n    )\n    \n    x += width\n  )\n  \n  // kinda looks weird imo, could add a setting tho\n  if sel != null and false (\n    goto sel[1] sel[2]\n    pen \"down\" : c#seco w#2\n    goto sel[3] sel[2]\n    goto sel[3] sel[4]\n    goto sel[1] sel[4]\n    goto sel[1] sel[2]\n    pen \"up\"\n  )\n)\n",""],[".osl","area","def boundriesToArea(number left, number top, number right, number bottom) (\n  return [left, top, right, bottom]\n)\n\ndef copy(area) (\n  return [area[1], area[2], area[3], area[4]]\n)\n\ndef centerX(area) (\n  return area[1] + area[3] / 2\n)\n\ndef centerY(area) (\n  return area[2] + area[4] / 2\n)\n\ndef width(area) (\n  return area[3] - area[1]\n)\n\ndef height(area) (\n  return area[2] - area[4]\n)\n",""],[".osl","editor","\nnumber editorI = 0\nnumber selectedEditor = 0\nnumber tabI = 0\n\nclass Editor (\n  number tabsH = 30\n  \n  def init() (\n    self.tabs @= []\n    self.tabScroll = 0\n    self.selectedTab = 0\n    \n    // .btoa().trim(1,-3)\n    self.id = editor.editorI.toStr()\n    self.i = editor.editorI\n    editor.editorI ++\n  )\n  \n  def createTab(string kind, string title, string content) (\n    local dta @= {\n      kind,\n      title,\n      content,\n      id: OuidNew() ++ editor.tabI.toStr()\n    }\n    editor.tabI ++\n    \n    void self.tabs.append(dta)\n    void self.updateTab(dta)\n    self.selectedTab = self.tabs.len\n    return dta\n  )\n  def openFile(string uuid) (\n    local f @= open(uuid, [1,2,3,4])\n    local t @= self.createTab(\"file\", f[2], f[4])\n    t.ohf @= ohf.getCompiledOhf(f[1])\n    t.file_uuid = uuid\n  )\n  def updateTab(object tab) (\n    inputs[self.id ++ tab.id] @= tab.content.split(\"\\n\")\n  )\n  def selectTab(number i) (\n    self.selectedTab = i\n    if self.tabs[self.selectedTab] != null (\n      void self.updateTab(self.tabs[self.selectedTab])\n    )\n  )\n  \n  def update(array a) (\n    goto area.centerX(a) area.centerY(a)\n    square area.width(a) area.height(a) : c#prim\n    if onclick (\n      editor.selectedEditor = self.i\n    )\n    square area.width(a) - 3 area.height(a) - 3 : c#window_colour\n    \n    if self.selectedTab > self.tabs.len (\n      void self.selectTab(self.tabs.len)\n    )\n    if self.selectedTab == 0 (\n      void self.selectTab(1)\n    )\n    \n    void self.updateMore([\n      a[3] - 30,\n      a[2],\n      a[3],\n      a[2] - self.tabsH\n    ])\n    \n    void self.updateTabs([\n      a[1],\n      a[2],\n      a[3] - 30,\n      a[2] - self.tabsH\n    ])\n    \n    void self.updateContent([\n      a[1],\n      a[2] - self.tabsH,\n      a[3],\n      a[4]\n    ])\n  )\n  \n  def updateMore(array a) (\n    goto a[1] a[2]\n    c prim\n    pen \"size\" 1.5\n    pen \"down\"\n    goto a[1] a[4]\n    goto a[3] a[4]\n    pen \"up\"\n    \n    goto area.centerX(a) area.centerY(a)\n    square area.width(a) - 3.5 area.height(a) - 3.5 : c#window_colour hover_c#prim\n    if mouse_touching (\n      cursor \"pointer\"\n      if onclick (\n        local p @= Promise.new(() -> (\n          defer\n          while mouse_down (\n            defer\n          )\n          open_rightclick menus.editor.more()\n        ))\n        editor.selectedEditor = self.layoutI\n      )\n    )\n    icon \"more-vertical\" .65 : c#txtc\n  )\n  \n  def updateTabs(array a) (\n    goto a[1] a[4]\n    c prim\n    pen \"size\" 1.5\n    pen \"down\"\n    goto a[3] a[4]\n    pen \"up\"\n    \n    local width = 0\n    for i self.tabs.len (\n      local tab @= self.tabs[i]\n      tab.width = tab.title.len * 8 + 30 + 30\n      width += tab.width\n    )\n    \n    frame a[1] a[2] a[3] a[4] 0 (\n      goto 0 0\n      square frame.width frame.height 0 0 1\n      if mouse_touching (\n        self.tabScroll += scroll.x.velocity + scroll.y.velocity * -1.5 * scroll.multiplier\n      )\n      self.tabScroll = max(min(self.tabScroll, width - frame.width), 0)\n      \n      local x = frame.left - self.tabScroll\n      local rm = 0\n      for i self.tabs.len (\n        //log tab x\n        local tab @= self.tabs[i]\n        \n        x += tab.width / 2\n        \n        goto x 0\n        square tab.width frame.height 0 0 1\n        if mouse_touching (\n          if onclick (\n            void self.selectTab(i)\n          )\n          goto x frame.bottom + 2\n          square tab.width 1 : c#prim\n        )\n        \n        if self.selectedTab == i (\n          goto x frame.bottom + 2\n          square tab.width 1 : c#seco\n        )\n        \n        goto x 0\n        centext tab.title 8 : c#txtc chx#-10\n        \n        x += tab.width / 2\n        \n        icn = \"close\"\n        \n        goto x - 20 0\n        square 15 15 0 0 1\n        hoverIcn = mouse_touching\n        \n        if tab.kind == \"file\" (\n          local content = inputs[self.id ++ tab.id].join(\"\\n\")\n          local edited = content != open(tab.file_uuid)\n          \n          if edited and !hoverIcn (\n            icn = \"w 17.5 dot 0 0\"\n          )\n        )\n        \n        icon icn .5 : c#txtc\n        if hoverIcn (\n          cursor \"pointer\"\n          if onclick (\n            rm = i\n          )\n        )\n        \n        c prim\n        pen \"size\" 1\n        goto x frame.top\n        pen \"down\"\n        goto x frame.bottom\n        pen \"up\"\n      )\n      \n      if rm != 0 (\n        void self.tabs.delete(rm)\n      )\n      \n      if editor.selectedEditor == self.i (\n        local selTab @= self.tabs[self.selectedTab]\n        if selTab.kind == \"file\" (\n          if \"control\".isKeyDown() and \"s\".onKeyDown() (\n            file \"open\" selTab.file_uuid\n            file \"set\" 4 selTab.content\n            file \"close\"\n          )\n        )\n      )\n    )\n  )\n  \n  def updateContent(array a) (\n    if self.tabs.len == 0 (\n      goto area.centerX(a) area.centerY(a)\n      centext \"no open files :(\" 9 : c#prim\n      return\n    )\n    \n    void self.updateTextbox([\n      a[1],\n      a[2],\n      a[3],\n      a[4]\n    ])\n  )\n  def updateTextbox(array a) (\n    local tab @= self.tabs[self.selectedTab]\n    \n    if tab != null (\n      goto area.centerX(a) area.centerY(a)\n      textbox area.width(a) area.height(a) self.id ++ tab.id 0 {\n        line_numbers: {\n          bg_colour: prim,\n          text_colour: txtc\n        },\n        sel_colour: seco,\n        text_colour: txtc,\n        ohf: tab.ohf\n      }\n      tab.content = inputs[self.id ++ tab.id].join(\"\\n\")\n    )\n  )\n)\n",""],[".osl","icons","\nstring build = \"w 2 square 0 -4 2 6 line 6 10 9 10 cont 9 4 cont 6 4 cutcircle 4.5 10 1.5 13.5 45 cutcircle 4.5 4 1.5 4.5 45 line 4.5 8.5 2 8.5 line 4.5 5.5 2 5.5 cont 2 0 cutcircle .5 8.5 1.5 4.5 45 line .5 10 -4 10 curve -4 10 -10 5 -7 10 curve -10 5 -2 4 -2 7 line -2 2 -2 4\"\nstring play = \"w 3.5 line -7 10 7 0 cont -7 -10 cont -7 10\"\nstring menu = \"w 3.85 line -9 8 9 8 line -9 0 9 0 line -9 -8 9 -8\"\n\nstring editor = import(\"./icon.icn\")\n",""],[".osl","topbar","\nboolean debug = false\narray defaultButtons = [\n  {\n    icon: \"close\",\n    click: window.close\n  },\n  {\n    icon: \"down\",\n    click: window.minimise\n  },\n  {\n    icon: \"maximise\",\n    click: window.fullscreen\n  }\n]\n\nboolean menusOpen = false\n\ndef updateWinButtons(array buttons, boolean background) (\n  if background (\n    local w = buttons.len * 25\n    \n    loc -2 2 w / -2 - 7.5 -20\n    square w - 5 18 10 : c#prim\n  )\n  \n  loc -2 2 -20 -20\n  change_x 25\n  local i = 0\n  local len = buttons.len\n  while i < len (\n    i ++\n  //for i buttons.len (\n    local p = performance\n    local button @= buttons[i]\n    local p2 = performance\n    \n    c txtc\n    local p3 = performance\n    icon button.icon 0.6 * (button.icon_size ?? 1) : hover_size#1.1 chx#-25\n    \n    local p4 = performance\n    if mouse_touching (\n      cursor \"pointer\"\n      if onclick (\n        void button.click()\n      )\n    )\n    local p5 = performance\n    if background (\n      log p6 p p - p6\n    )\n    local p6 = performance\n  )\n  change_x -25\n  self.buttonsX = x_position\n)\n\ndef updateWidgets(array widgets, string side) (\n  local mul = side == \"right\" ? -1 1\n  local x = side == \"right\" ? buttonsX window.left + 50 + 35\n  local visualI = 0\n  for i widgets.len (\n    local widget @= widgets[i]\n    if widget.earlyUpdate != null (\n      void widget.earlyUpdate()\n    )\n    if widget.enabled ?? true (\n      visualI ++\n      local w = widget.width ?? 20\n      \n      if visualI != 1 (\n        x += (widget.background ? 10 7.5) * mul\n      ) else (\n        x += widget.background ? 0 -10 * mul\n      )\n      x += w / 2 * mul\n      \n      goto x window.top - 20\n      if widget.background and widget.showBackground ?? true (\n        square w - 5 15 15 : c#prim\n      )\n      \n      square w - 5 15 15 0 1\n      widget.hovered = mouse_touching\n      widget.clicked = onclick\n      \n      frame x - (w / 2) - 5 window.top - 5 x + (w / 2) + 5 window.top - 35 (\n        if widget.update != null (\n          c txtc\n          goto 0 0\n          void widget.update()\n        )\n      )\n      \n      x += w / 2 * mul\n      x += (widget.background ? 10 7.5) * mul\n    )\n  )\n  \n  if side == \"left\" (\n    self.dragbox[1][3] = x - window.left - 5\n  )\n  if side == \"right\" (\n    self.dragbox[2][3] = x - window.right - 5\n  )\n)\n\ndef updateLeftSection() (\n  goto window.left + 20 window.top - 20\n  \n  if !self.menusOpen (\n    square 25 25 0 0 1 : c#fff\n    icon icons.editor 1.25\n    change_x 35\n  )\n  \n  icon icons.menu 1 : c#txtc\n  if mouse_touching (\n    cursor \"pointer\"\n    if onclick (\n      self.menusOpen = !self.menusOpen\n    )\n  )\n)\n\ndef updateMenus() (\n  local x = frame.left\n  \n  local keys @= menus.topbar.top_menus.getKeys()\n  for i keys.len (\n    local name = keys[i].toTitle()\n    local width = name.len * 9 + 20\n    \n    x += width / 2 + 7.5\n    \n    goto x 0\n    square width - 5 15 15 10 : c#prim hover_c#seco\n    local click = onclick\n    centext name 9 : c#txtc\n    \n    x += width / 2 + 10\n    \n    x -= width + 12.5\n    \n    goto x - 5 -25\n    if click (\n      local p @= Promise.new(() -> (\n        defer\n        while mouse_down (\n          defer\n        )\n        open_rightclick self.menu() ?? []\n      ))\n      p.worker.menu @= menus.topbar.top_menus[keys[i]]\n    )\n    \n    x += width + 12.5\n  )\n  \n  self.dragbox[1][3] = x - frame.left + 40\n)\n\ndef resetDragbox() (\n  self.dragbox @= [[2,2,0,0],[-2,2,-90,-40]]\n)\n\ndef applyDragbox() (\n  window.setDragbox(self.dragbox[1], self.dragbox[2])\n  \n  if self.debug (\n    c #fff\n    loc self.dragbox[1][1] self.dragbox[1][2] self.dragbox[1][3] self.dragbox[1][4]\n    pen \"down\" : w#1\n    loc self.dragbox[2][1] self.dragbox[2][2] self.dragbox[2][3] self.dragbox[2][4]\n    pen \"up\"\n  )\n)\n\ndef update() (\n  void self.resetDragbox()\n  \n  void self.updateWinButtons(self.defaultButtons, false)\n  if self.menusOpen (\n    frame window.left + 40 window.top self.buttonsX window.top - 40 (\n      void self.updateMenus()\n    )\n  ) else (\n    void self.updateWidgets(widgets.left, \"left\")\n  )\n  void self.updateWidgets(widgets.right, \"right\")\n  void self.updateLeftSection()\n  \n  void self.applyDragbox()\n)\n",""],[".osl","state","\nstring folder = \"\"\nobject opal = {}\n\ndef loadFolder(string uuid) (\n  if uuid == \"\" (\n    self.clearFolder()\n    return\n  )\n  \n  local f @= open(uuid, [1,2,3])\n  if f[1] != \".folder\" (\n    say \"given folder is not a folder\"\n    return\n  )\n  \n  self.folder = uuid\n  loadOpal()\n)\n\ndef clearFolder() (\n  self.folder = \"\"\n  self.opal @= {}\n)\n\ndef loadOpal() (\n  local f @= open(self.folder, [2,3])\n  local opalf @= open(f[2] ++ \"/\" ++ f[1] ++ \"/\" ++ \"opal.json\")\n  if typeof(opalf) == \"string\" (\n    opalf @= opalf.JsonParse()\n  )\n  if typeof(opalf) == \"object\" (\n    self.opal @= opalf\n  )\n)",""],[".osl","files","\nnumber width = 200\nnumber height = 0\nobject opened = {}\n\nnumber x = 0\nnumber y = 0\n\ndef update(array a) (\n  goto area.centerX(a) area.centerY(a)\n  square area.width(a) area.height(a) : c#prim\n  square area.width(a) - 3 area.height(a) - 3 : c#window_colour\n  \n  c prim\n  frame a[1] a[2] a[3] a[4] self.height \"files\" (\n    local hover = mouse_x >= frame.left and mouse_x <= frame.right\n    hover = hover and mouse_y >= frame.bottom and mouse_y <= frame.top\n    self.hovered = hover\n    if file_dragging and hover (\n      centext \"drop folder here\" 9 : c#txtc\n      return\n    )\n    \n    local folder @= open(state.folder)\n    if typeof(folder) != \"array\" (\n      centext \"no open folder\" 9 : c#prim\n      return\n    )\n    \n    self.x = frame.left\n    self.y = frame.top + frame.scroll\n    local start = self.y\n    drawContents(folder)\n    self.height = start - self.y\n  )\n)\n\ndef drawContents(array items) (\n  items @= items.map(i -> [i, open(i, [1])])\n  \n  local folders @= items.filter(i -> i[2][1] == \".folder\")\n  local files @= items.filter(i -> i[2][1] != \".folder\")\n  \n  for i folders.len (\n    drawFile(folders[i][1])\n  )\n  for i files.len (\n    drawFile(files[i][1])\n  )\n  // stops compiler from being weird\n  return\n  square\n)\n\ndef drawFile(string uuid) (\n  self.y -= 15\n  \n  local f @= open(uuid, [1,2,3,11])\n  \n  goto 0 self.y\n  square frame.width 20 10 0 1\n  rightclick \"file\" uuid\n  local hover = mouse_touching and !layout.filesResizing and !layout.filesResizingHover\n  local click = onclick and !layout.filesResizing\n  \n  if hover (\n    square frame.width - 15 15 10 : c#prim\n    cursor \"pointer\"\n  )\n  \n  goto self.x self.y\n  \n  if f[1] == \".folder\" (\n    local open = self.opened[uuid] ?? false\n    \n    icon open ? \"down\" \"right\" .45 : chx#15 c#txtc\n    file \"render\" .6 : chx#20\n    text f[2] 9 : c#txtc chx#15\n    \n    self.x += 20\n    self.y -= 15\n    \n    if open (\n      drawContents(open(uuid))\n    )\n    \n    self.x -= 20\n    \n    if click (\n      self.opened[uuid] = !open\n    )\n  ) else (\n    file \"render\" .6 : chx#15\n    text f[2] 9 : c#txtc chx#15\n    text f[1] 8 : c#seco\n    self.y -= 15\n    \n    if click (\n      local editor @= utils.getEditorAndAdd()\n      if editor != null (\n        void editor.openFile(uuid)\n      )\n    )\n  )\n)\n",""],[".osl","ohf","\ndef compileOhf(ohf) (\n  if typeof(ohf) == \"string\" (\n    ohf @= ohf.JsonParse()\n  )\n  if typeof(ohf) != \"object\" (\n    return \"\"\n  )\n  \n  local output @= {\n    tokens: {},\n    overrides: {},\n    parser: {}\n  }\n\n  try (\n    if ohf.categories != null (\n      each o ohf.categories.getValues() (\n        each r o.tokens (\n          output.tokens[\"tkn:\" ++ r] = o.color\n        )\n      )\n    )\n  \n    if ohf.overrides != null (\n      each o ohf.overrides.getKeys() (\n        output.overrides[o] = ohf.overrides[o]\n      )\n    )\n  \n    output.parser = ohf.parser ?? {}\n    output.highlighter = ohf.highlighter ?? {}\n  ) catch o (\n    error o\n    return \"\"\n  )\n  return output\n)\n\ndef getCompiledOhf(string kind) (\n  return compileOhf(getOhf(kind))\n)\n\ndef getOhf(string kind) (\n  return open(\"~/application data/Studio/\" ++ kind.trim(2,-1) ++ \".ohf\")\n)\n",""],[".osl","utils","\ndef getEditorAndAdd() (\n  if layout.editors.len == 0 (\n    void layout.editors.append(editor.Editor())\n  )\n  return getEditor()\n)\ndef getEditor() (\n  local editorI = editor.selectedEditor ?? 1\n  local editor @= layout.editors.filter(e -> e.i == editorI)[1]\n  return editor\n)\n\ndef getTab() (\n  local e @= getEditor()\n  return e.tabs[e.selectedTab]\n)\n\ndef getMain() (\n  void state.loadOpal()\n  \n  local opalMain = state.opal.main\n  if typeof(opalMain) == \"string\" (\n    local folder @= open(state.folder, [2,3])\n    return folder[2] ++ \"/\" ++ folder[1] ++ \"/\" ++ opalMain\n  )\n  \n  return self.getTab().file_uuid\n)\n\ndef fileUuidToPath(string uuid) (\n  local fdata @= open(uuid, [1,2,3])\n  \n  return fdata[3] ++ \"/\" ++ fdata[2] ++ fdata[1]\n)\n\ndef folderUuidToPath(string uuid) (\n  local fdata @= open(uuid, [2,3])\n  \n  return fdata[2] ++ \"/\" ++ fdata[1]\n)\n",""],[".osl","menus","\ndef createMenu() (\n  return []\n)\ndef addButton(array menu, string text, function func) (\n  local obj @= menus.empty()\n  obj[text.toTitle()] @= func\n  void menu.append(obj)\n)\ndef addSeperator(array menu) (\n  void menu.append(\"-\")\n)\n\nempty @= () -> (\n  local obj @= {\"bleh\":def()->()}\n  void obj.delete(\"bleh\")\n  return obj\n)\n\nobject topbar = {\n  name: () -> (\n    local menu @= menus.createMenu()\n    \n    void menus.addButton(menu, \"copy folder path\", (data) -> (\n      clipboard \"set\" data.replace(\"origin/(c) users/\" ++ username, \"~\")\n    ))\n    \n    return menu\n  ),\n  \n  top_menus: {\n    file: () -> (\n      local menu @= menus.createMenu()\n      \n      void menus.addButton(menu, \"new\", () -> (\n        topbar.menusOpen = false\n        \n        void state.clearFolder()\n      ))\n      \n      void menus.addSeperator(menu)\n      \n      void menus.addButton(menu, \"open file\", (data) -> (\n        topbar.menusOpen = false\n        \n        void picker.openPicker([], def(content, uuid) -> (\n          local editor @= utils.getEditorAndAdd()\n          if editor != null (\n            void editor.openFile(uuid)\n          )\n        ))\n      ))\n      void menus.addButton(menu, \"open folder\", (data) -> (\n        topbar.menusOpen = false\n        \n        void picker.openPicker([\"folder\"], def(content, uuid) -> (\n          void state.loadFolder(uuid)\n        ))\n      ))\n      \n      return menu\n    ),\n    edit: () -> (\n      local menu @= menus.createMenu()\n      \n      return menu\n    )\n  }\n}\n\nobject editor = {\n  more: () -> (\n    log menus\n    local menu @= menus.createMenu()\n    \n    void menus.addButton(menu, \"new editor to the left\", () -> (\n      void layout.editors.insert(editor.selectedEditor, editor.Editor())\n    ))\n    void menus.addButton(menu, \"new editor to the right\", () -> (\n      void layout.editors.insert(editor.selectedEditor + 1, editor.Editor())\n    ))\n    \n    if layout.editors.len > 1 (\n      void menus.addSeperator(menu)\n      void menus.addButton(menu, \"remove Editor\", () -> (\n        void layout.editors.delete(editor.selectedEditor)\n      ))\n    )\n    \n    return menu\n  )\n}",""],[".osl","save","\ndef init() (\n  void self.setName(\"code@flufi\")\n)\n\ndef setName(string name) (\n  save name \"set_directory\"\n)\n\ndef exists(string fileName) (\n  return fileName.saveExists()\n)\n\ndef get(string fileName) (\n  if !self.exists(fileName) (\n    throw fileName ++ \"does not exist\"\n  )\n\n  return fileName.saveGet().toStr()\n)\n\ndef set(string fileName, string data) (\n  save fileName \"set\" data\n)\n\n",""],[".osl","settings","\nobject entries = {\n  test: {\n    bleh: {\n      type: \"boolean\",\n      desc: \"fr\",\n      default: false\n    }\n  }\n}\n\nobject _data = {}\n\ndef load() (\n  if !save.exists(\"settings.json\") (\n    void self.write()\n  )\n  self._data @= self.deserialize(save.get(\"settings.json\"))\n  void self.applySettings()\n  void self.write()\n)\n\ndef write() (\n  void save.set(\"settings.json\", self.serialize())\n)\n\ndef get(string category, string entry) (\n  return self._data[category][entry]\n)\ndef set(string category, string entry, value) (\n  local entryData @= self.entries[category][entry]\n  if entryData == null (\n    throw \"setting\" + category ++ \"/\" ++ entry + \"doesnt exist\"\n  )\n  \n  if entryData.type != typeof(value) (\n    throw \"expected\" + entry.type + \"for\" + category ++ \"/\" ++ entry + \"but got\" + typeof(value)\n  )\n  self._data[category][entry] @= value\n  void self.write()\n  void self.applySettings()\n)\n\ndef applySettings() (\n  local categoryData @= self.entries.getEntries()\n  for categoryI categoryData.len (\n    local category @= categoryData[categoryI]\n    local entryData @= category[2].getEntries()\n    for entryI entryData.len (\n      local entry @= entryData[entryI]\n      local value = self._data[category[1]][entry[1]] ?? entry[2].default\n      if entry[2].applySetting != null (\n        void entry[2].applySetting(value)\n      )\n    )\n  )\n)\n\ndef serialize() (\n  local out @= {}\n  local categoryData @= self.entries.getEntries()\n  for categoryI categoryData.len (\n    local category @= categoryData[categoryI]\n    out[category[1]] @= {}\n    local entryData @= category[2].getEntries()\n    for entryI entryData.len (\n      local entry @= entryData[entryI]\n      local value = self._data[category[1]][entry[1]] ?? entry[2].default\n      out[category[1]][entry[1]] @= value\n    )\n  )\n  return out.JsonStringify()\n)\ndef deserialize(string data) (\n  local raw @= data.JsonParse()\n  \n  local out @= {}\n  local categoryData @= self.entries.getEntries()\n  for categoryI categoryData.len (\n    local category @= categoryData[categoryI]\n    out[category[1]] @= {}\n    local entryData @= category[2].getEntries()\n    for entryI entryData.len (\n      local entry @= entryData[entryI]\n      local value = raw[category[1]][entry[1]] ?? entry[2].default\n      out[category[1]][entry[1]] @= value\n    )\n  )\n  return out\n)\n",""],[".osl","picker","object pickers = {}\n\ndef update() (\n  if new_transmit (\n    local keys @= pickers.getKeys()\n    for i keys.len (\n      if transmit_source == keys[i] (\n        local p @= pickers[keys[i]]\n        void p[1](open(transmit_data), transmit_data, p[2])\n        void pickers.delete(keys[i])\n      )\n    )\n    new_transmit = false\n  )\n)\n\ndef openPicker(array types, function callback, arg) (\n  file \"pick\" types\n  picker.pickers[data] @= [callback, arg]\n)",""],[".osl","popup","\nobject popups = {\n  testPopup: {\n    update: () -> (\n      centext \"hi\" 10\n    )\n  }  \n}\n\ndef openPopup(object popup) (\n  window.create(window.file.uuid, {\n    passed_data: {\n      popup\n    },\n  })\n)\n\ndef update() (\n  void self.updateTopbar()\n)\n\ndef updateTopbar() (\n  //void topbar.resetDragbox()\n  \n  void topbar.updateWinButtons(topbar.defaultButtons, true)\n)\n",""],[".osl","compiler","\nobject compilers @= {}\n\ndef addCompiler(string name, object compiler, object extra) (\n  compiler.extra @= extra\n  self.compilers[name] @= compiler\n)\n\ndef addOpalLikeCompiler(string name, object mod) (\n  // override open\n  mod.compilerObj.open @= def(path) -> (\n    local path = terminal.pwd ++ \"/\" ++ path\n    if !path.startsWith(\"origin/\") (\n      path = parseFilePath(path)\n    )\n    file \"exists\" path\n    local data = exists ? open(path) null\n    return { exists, data }\n  )\n  \n  void self.addCompiler(name, {\n    build: def(string pwd) -> (\n      local usrPath = \"origin/(c) users/\" ++ username\n      if pwd.toLower().startsWith(usrPath.toLower()) (\n        pwd = \"~\" ++ pwd.trim(usrPath.len + 1, -1)\n      )\n      terminal.pwd = pwd\n      self.extra.pwd = pwd\n      void self.extra.build()\n    )\n  }, mod.compilerObj)\n)\n\n// langs\ndef getOslCompiler() (\n  local out = null\n  \n  out ??= self.compilers.fpp\n  \n  return out\n)\n",""],[".osl","terminal","\nclass terminal (\n  lines = []\n  waiting = false\n  show_input = true\n  input_message = null\n  pwd = user_folder\n  \n  def writeLine(data) (\n    if data.contains(\"\\n\") (\n      local parts = data.split(\"\\n\")\n      for i parts.len (\n        void self.lines.append(parts[i])\n      )\n    ) else (\n      void self.lines.append(data)\n    )\n  )\n  \n  def write(data) (\n    self.lines[self.lines.len] ++= data\n  )\n  \n  def clear() (\n    terminal.lines = []\n  )\n  \n  def input(query) (\n    self.show_input = true\n    self.input_message = query\n    while self.show_input (\n      defer\n    )\n    self.input_message = null\n    return last.pop()\n  )\n  \n  def user_start() (\n    if self.input_message != null (\n      return self.input_message ++ \": \"\n    )\n    local pos = self.pwd\n    if pos == user_folder (\n      pos = \"~\"\n    ) else (\n      pos = pos.split(\"/\")[-1]\n    )\n    return username ++ \"@originos \" ++ pos ++ \" % \"\n  )\n\n  def run(cmd) (\n    return terminal_worker.evalCmd(cmd)\n  )\n)\n",""],[".folder","compilers",[[".osl","fpp","// welcome to fpp :P\n// this is meant as an alternative to opal, with a few extra features i wanted :3\n// (a lot of this will be code from opal)\n// fpp is also fully compatible with opal (it uses opal.json)\n\n// package src\nlocal repo = \"https://opal.mistium.com\"\n\nlocal log @= def(d) -> (\n  if d.contains(\"\\n\") (\n    d = d.split(\"\\n\")\n    for i d.len (\n      terminal.writeLine(d[i])\n    )\n    return\n  )\n  terminal.writeLine(d)\n)\n\nlocal pwd = terminal.pwd.split(\"/\")\npwd[1] = \"\"\npwd @= pwd.join(\"/\")\n\nlocal c @= {\n  err: \"#FF2929\",\n  ok: \"#31ba1c\",\n  fpp: \"#8457d9\"\n}\n\nlocal fpp @= {\n  about: {\n    version: \"1.3.1\"\n  },\n  getPackages: def() -> (\n    local val @= self.open(\"packages.folder\")\n    local resp @= self.resp\n    if val.exists (\n      local json = val.data.JsonParse()\n      if typeof(json) != \"array\" (\n        return resp(\"log\", [\n          c.err, \"packages/ seems to be corrupted, use \",\n          c.fpp, \"fpp init\",\n          c.err, \" to reset your project\"\n        ])\n      )\n      if json.len == 0 (\n        return resp(\"log\", \"No installed opal packages\")\n      )\n      return resp(\"arr\", json.map(v -> open(v, [\"name\"])[1]))\n    ) else (\n      return resp(\"log\", [\n        c.err, \"No packages/ found, use \",\n        c.opl, \"fpp init\",\n        c.err, \" to setup your project\"\n      ])\n    )\n  ),\n  open: def(path) -> (\n    local path = parseFilePath(pwd ++ \"/\" ++ path)\n    file \"exists\" path\n    local data = exists ? open(path) null\n    return { exists, data }\n  ),\n  fetchPackage: def(name) -> (\n    local json = self.fetchFile(name, \"/package.json\")\n    local exists = true\n    if typeof(json) != \"object\" (\n      json = {}\n      exists = false\n    )\n    return { exists, json }\n  ),\n  fetchFile: def(name, file) -> (\n    return (self.repo ++ \"/packages/\" ++ name ++ file).httpGet().JsonParse()\n  ),\n  install: def(name, bypass) -> (\n    local opal_json = self.open(\"opal.json\").data.JsonParse()\n    local v = \"latest\"\n    name = name.split(\":\")\n    if name.len > 1 (\n      v = name[2].replace(\"_\", \".\")\n    )\n    \n    local data = self.fetchPackage(name[1])\n    if !data.exists (\n      log([opal.c.err, \"No package found with that name\"])\n      break\n    )\n    data @= data.json\n    \n    local cur = null\n    local vers @= data.versions\n    if v == \"latest\" (\n      cur @= vers[-1]\n    ) else (\n      for i vers.len (\n        if vers[i].version == v (\n          cur @= vers[i]\n          break\n        )\n      )\n    )\n    if cur == null (\n      log([c.err, \"Unable to find specified version of package\"])\n      return\n    )\n    \n    local install = true\n    if !bypass (\n      log(\"Install \" ++ cur.name ++ \"(\" ++ cur.version ++ \") - size: \" ++ cur.size ++ \"?\")\n      if terminal.input(\"y/n\") != \"y\" (\n        install = false\n      )\n    )\n    if install (\n      if cur.install != null (\n        log(\"Found install script: \" ++ cur.install)\n        // run the package's install script\n        local fn = function(\"opal\", self.fetchFile(name[1], \"/\" ++ cur.version ++ \"/\" ++ cur.install))\n        void fn(fpp)\n        log(\"Finished running install script\")\n      )\n      // write the script its to the /packages directory\n      file \"goto_dir\" self.pwd ++ \"/packages\"\n      log(\"Fetching package script\")\n      local contents = self.fetchFile(name[1], \"/\" ++ cur.version ++ \"/\" ++ cur.main)\n      file \"set_file\" cur.name ++ \".osl\" contents\n      log(\"Written package to drive\")\n      \n      // write to the opal.json\n      file \"goto_dir\" self.pwd\n      log(\"Writing dependencies to opal.json\")\n      opal_json.dependencies ??= {}\n      opal_json.dependencies[cur.name[1]] = cur.version\n      file \"set_file\" \"opal.json\" opal_json.JsonFormat()\n      log(\"Installed\")\n    ) else (\n      log(\"Aborted\")\n    )\n  ),\n  build: def() -> (\n    local cfg @= self.open(\"opal.json\").data.JsonParse()\n    \n    local file @= self.open(cfg.main ?? \"script.osl\")\n    if !file.exists (\n      log([c.err, \"script.osl not found, use \", c.fpp, \"fpp init\", c.err, \" to create a new project\"])\n      return\n    )\n    \n    local ast @= file.data.oslAST()\n    local queue = []\n    for i ast.len (\n      local line = ast[i][1].line\n      for j ast[i].len (\n        ast[i][j].line = line\n        void queue.append(ast[i][j])\n      )\n    )\n    log(\"Parsing script.osl\")\n    log(\"Collecting imports\")\n    \n    local imports @= {}\n    \n    if cfg.include != null (\n      for includeI cfg.include.len (\n        void queue.append({\n          type: \"fnc\",\n          data: \"import\",\n          parameters: [\n            {\n              type: \"str\",\n              data: cfg.include[includeI]\n            }\n          ]\n        })\n      )\n    )\n    \n    while queue.len > 0 (\n      local item @= queue.shift()\n      if item.left != null (\n        void queue.append(item.left)\n      )\n      if [\"blk\", \"obj\"].contains(item[\"type\"]) (\n        local data @= item.data\n        for i data.len (\n          for j data[i].len (\n            void queue.append(data[i][j])\n          )\n        )\n      )\n      if item.type == \"arr\" (\n        for i item.data.len (\n          void queue.append(item.data[i])\n        )\n      )\n      if item.right != null (\n        void queue.append(item.right)\n      )\n      if item[\"type\"] == \"fnc\" and item.data == \"function\" (\n        void queue.append(item.parameters[2])\n      )\n      if item[\"type\"] == \"fnc\" and item.data == \"import\" (\n        local params @= item.parameters\n        local invalid_msg = \"Invalid import statement on line \"\n        if params.len != 1 (\n          log([c.err, invalid_msg ++ item.line ++ \", expected 1 parameter, got \" ++ params.len])\n          return\n        )\n        if params[1][\"type\"] != \"str\" (\n          log([c.err, invalid_msg ++ item.line ++ \", expected string parameter, got \" ++ params[1][\"type\"]])\n          return\n        )\n        local path = params[1].data\n        item.type = \"mtd\"\n        item.data = mtd.data\n        item.data[2].parameters[1].data = path\n        log(\"Collected \" ++ path)\n        local parsed = path\n        if path.startsWith(\"./\") (\n          parsed @= parsed.replaceFirst(\".\", self.pwd)\n        )\n        if !path.startsWith(\"origin/\") (\n          local parsed = parseFilePath(parsed)\n        )\n        if imports[path] != null (\n          continue\n        )\n        file \"exists\" parsed\n        if !exists (\n          log([c.err, \"Import file not found: \", parsed])\n          return\n        )\n        local data = open(parsed)\n        if data == null (\n          log([c.err, \"Failed to open import file: \", parsed])\n          return\n        )\n        if path.endsWith(\".osl\") (\n          try (\n            local ast_cur @= data.oslAST()\n            for i ast_cur.len (\n              local line = ast_cur[i][1].line\n              for j ast_cur[i].len (\n                ast_cur[i][j].line = line\n                void queue.append(ast_cur[i][j])\n              )\n            )\n          ) catch e (\n            log([c.err, \"Failed to parse import file: \", parsed, \"\\nError: \", e])\n            return\n          )\n        )\n        imports[path] @= data\n      )\n      void item.delete(\"source\")\n    )\n    \n    local prepend = [\"build @= { built: true, package:\" + cfg.JsonStringify() + \"}\"]\n    void prepend.append(\"opal_imports = {}\\ndef import(path) (\\n  switch path (\\n\")\n    local import_keys @= imports.getKeys().reverse()\n    local indent = def(str) -> (\n      return str.replace(\"/^/gm\", \"  \")\n    )\n    for i import_keys.len (\n      local key = import_keys[i]\n      local data = indent(imports[key].strip())\n      local hash = \"__imports__\" ++ key.hashMD5()\n      log(\"Compiled \" ++ key ++ \" \" ++ i ++ \"/\" ++ import_keys.len)\n      void prepend.append(\"case \\\"\" ++ key ++ \"\\\"\")\n      if key.endsWith(\".osl\") (\n        void prepend.append(\"  class \" ++ hash ++ \" (\\n\" ++ indent(data ++ \"\\n)\"))\n        void prepend.append(\"  return \" ++ hash)\n      ) else (\n        void prepend.append(\"  return\" + data.JsonStringify() ++ \"\\n\")\n      )\n    )\n\n    local out = prepend.join(\"\\n\") ++ \")\\n)\\n\" ++ file.data.replaceFirst(\"__import @= import;import @= i -> (i.endsWith(\\\".osl\\\") ? __import(i) open(i))\",\"\").replaceFirst(\"build ??= { built: false, package: import(\\\"./opal.json\\\").JsonParse() }\",\"\")\n\n    file \"goto_dir\" self.pwd\n    if !self.open(\"build.folder\").exists (\n      log(\"Creating /build directory\")\n      file \"set_file\" \"build.folder\"\n    )\n    file \"open\" \"build.folder\"\n    file \"set\" 11 \"c #703d00 square 0 2 10 4 c #FF9800 square -8 6 2 2 line -5 7 3 0 square 0 -1 10 5 w 8 square 0 -0.5 5 0\"\n    file \"close\"\n    \n    file \"goto_dir\" self.pwd ++ \"/build\"\n    log(\"Writing built file\")\n    file \"set_file\" \"script.osl\" out\n    log(\"Written to /build/script.osl\")\n    local icn = self.open(\"icon.icn\").data\n    if icn != null (\n      file \"open\" \"script.osl\"\n      file \"set\" 11 icn\n      file \"close\"\n    )\n    if cfg.icon != null (\n      file \"open\" \"script.osl\"\n      file \"set\" 11 cfg.icon\n      file \"close\"\n    )\n  ),\n  format: {\n    arr: v -> v.join(\", \").wrapText(40)\n  }\n}\n\nfpp.c @= c\nfpp.log @= log\nfpp.pwd @= pwd\nfpp.repo @= repo\nfpp.resp @= (t, d) -> {t, d}\n\nobject compilerObj @= fpp\n",""]],""]],"c #0f5c3d square 0 2 10 4 c #1fd18a square -8 6 2 2 line -5 7 3 0 square 0 -1 10 5 w 8 square 0 -0.5 5 0"],[".folder","widgets",[[".osl","run","\nnumber width = 20\nboolean background = true\n    \ndef earlyUpdate() (\n  local f @= utils.getMain()\n  \n  self.enabled = f != null\n)\n\ndef update() (\n  goto 0 0\n  icon icons.play .6\n  \n  if self.hovered (\n    cursor \"pointer\"\n    if self.clicked (\n      local f @= utils.getMain()\n      if f != null (\n        file \"open\" f\n        file \"start\"\n        file \"close\"\n      )\n    )\n  )\n)\n",""],[".osl","build","\nnumber width = 20\nboolean background = true\n\ndef earlyUpdate() (\n  local f @= utils.getMain()\n  \n  local comp = compiler.getOslCompiler()\n  self.comp @= comp\n  self.enabled = f != null and comp != null\n)\n\ndef update() (\n  goto frame.left + 15 0\n  icon icons.build .6\n  \n  if self.hovered (\n    cursor \"pointer\"\n    if self.clicked (\n      void self.comp.build(utils.folderUuidToPath(state.folder))\n    )\n  )\n)",""],[".osl","folder","\nboolean enabled = false\nboolean background = true\n\ndef earlyUpdate() (\n  local folder @= open(state.folder)\n  self.enabled = folder != null\n)\n\ndef update() (\n  local folder = open(state.folder, [2, 3])\n  self.width = folder[1].len * 10 + 10\n  goto 0 0\n  centext folder[1] 10 : c#txtc\n  if mouse_touching (\n    cursor \"pointer\"\n    if onclick (\n      local p @= Promise.new(() -> (\n        defer\n        while mouse_down (\n          defer\n        )\n        open_rightclick menus.topbar.name() self.folder[2] ++ \"/\" ++ self.folder[1]\n      ))\n      p.worker.folder @= folder\n    )\n  )\n)\n",""],[".osl","test","\nnumber width = 30\nboolean background = true\n\ndef update() (\n  centext \"hi\" 10\n  if self.clicked (\n    void popup.openPopup(popup.popups.testPopup)\n  )\n)\n",""]],"c #245e10 square 0 2 10 4 c #54db27 square -8 6 2 2 line -5 7 3 0 square 0 -1 10 5 w 8 square 0 -0.5 5 0"]],"c #0f5c3d square 0 2 10 4 c #1fd18a square -8 6 2 2 line -5 7 3 0 square 0 -1 10 5 w 8 square 0 -0.5 5 0"]